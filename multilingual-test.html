<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šè¯­è¨€åŠŸèƒ½æµ‹è¯• - FastFun RC</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007AFF;
        }
        .language-selector {
            background: white;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056CC; }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸŒ FastFun RC å¤šè¯­è¨€åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ¦‚è§ˆ</h2>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•å¤šè¯­è¨€åŠŸèƒ½çš„å®Œæ•´æ€§å’Œä¿®å¤æ•ˆæœã€‚</p>
        <div id="testStatus" class="test-result info">æ­£åœ¨åˆå§‹åŒ–æµ‹è¯•...</div>
    </div>

    <div class="test-section">
        <h2>ğŸ”„ è¯­è¨€åˆ‡æ¢æµ‹è¯•</h2>
        <div class="language-selector">
            <button onclick="testLanguage('en')">English</button>
            <button onclick="testLanguage('es')">EspaÃ±ol</button>
            <button onclick="testLanguage('pt')">PortuguÃªs</button>
            <button onclick="testLanguage('fr')">FranÃ§ais</button>
            <button onclick="testLanguage('it')">Italiano</button>
        </div>
        <div id="languageTestResult" class="test-result info">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•è¯­è¨€åˆ‡æ¢</div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ ç¿»è¯‘é”®å€¼æµ‹è¯•</h2>
        <div id="translationTestResult" class="test-result info">æ­£åœ¨æµ‹è¯•ç¿»è¯‘é”®å€¼å®Œæ•´æ€§...</div>
        <div id="missingKeys" class="code-block"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ åŠŸèƒ½ç»„ä»¶æµ‹è¯•</h2>
        <div id="componentTestResult" class="test-result info">æ­£åœ¨æµ‹è¯•åŠŸèƒ½ç»„ä»¶...</div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»</h2>
        <div id="summaryResult" class="test-result info">æµ‹è¯•è¿›è¡Œä¸­...</div>
    </div>

    <script>
        let testResults = {
            translationLoad: false,
            languageSwitch: false,
            keyCompleteness: false,
            componentFunction: false
        };

        // åŠ è½½ç¿»è¯‘æ–‡ä»¶
        async function loadTranslations() {
            try {
                const response = await fetch('translations.json');
                const translations = await response.json();
                return translations;
            } catch (error) {
                console.error('Error loading translations:', error);
                return null;
            }
        }

        // æµ‹è¯•è¯­è¨€åˆ‡æ¢
        async function testLanguage(lang) {
            const translations = await loadTranslations();
            const resultDiv = document.getElementById('languageTestResult');
            
            if (!translations) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ æ— æ³•åŠ è½½ç¿»è¯‘æ–‡ä»¶`;
                return;
            }

            if (!translations[lang]) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ è¯­è¨€ '${lang}' ä¸å­˜åœ¨`;
                return;
            }

            // æµ‹è¯•å…³é”®é”®å€¼
            const criticalKeys = ['nav.home', 'home.heroTitle', 'home.heroCtaPrimary', 'home.heroCtaSecondary'];
            const missingKeys = criticalKeys.filter(key => {
                const keys = key.split('.');
                let value = translations[lang];
                for (const k of keys) {
                    value = value?.[k];
                }
                return !value;
            });

            if (missingKeys.length === 0) {
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… è¯­è¨€ '${lang}' åˆ‡æ¢æˆåŠŸï¼Œæ‰€æœ‰å…³é”®é”®å€¼å®Œæ•´`;
                testResults.languageSwitch = true;
            } else {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ è¯­è¨€ '${lang}' ç¼ºå°‘é”®å€¼: ${missingKeys.join(', ')}`;
            }
        }

        // æµ‹è¯•ç¿»è¯‘é”®å€¼å®Œæ•´æ€§
        async function testTranslationCompleteness() {
            const translations = await loadTranslations();
            const resultDiv = document.getElementById('translationTestResult');
            const missingKeysDiv = document.getElementById('missingKeys');
            
            if (!translations) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'âŒ æ— æ³•åŠ è½½ç¿»è¯‘æ–‡ä»¶';
                return;
            }

            const languages = ['en', 'es', 'pt', 'fr', 'it'];
            const baseKeys = getNestedKeys(translations.en);
            const missingReport = {};

            languages.forEach(lang => {
                if (!translations[lang]) {
                    missingReport[lang] = ['æ•´ä¸ªè¯­è¨€æ–‡ä»¶ç¼ºå¤±'];
                    return;
                }

                const langKeys = getNestedKeys(translations[lang]);
                const missing = baseKeys.filter(key => !langKeys.includes(key));
                
                if (missing.length > 0) {
                    missingReport[lang] = missing;
                }
            });

            const hasMissing = Object.keys(missingReport).length > 0;
            
            if (hasMissing) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'âŒ å‘ç°ç¼ºå¤±çš„ç¿»è¯‘é”®å€¼';
                missingKeysDiv.textContent = JSON.stringify(missingReport, null, 2);
            } else {
                resultDiv.className = 'test-result success';
                resultDiv.textContent = 'âœ… æ‰€æœ‰è¯­è¨€çš„ç¿»è¯‘é”®å€¼å®Œæ•´';
                missingKeysDiv.textContent = 'æ‰€æœ‰é”®å€¼å®Œæ•´ âœ…';
                testResults.keyCompleteness = true;
            }
        }

        // è·å–æ‰€æœ‰åµŒå¥—é”®å€¼
        function getNestedKeys(obj, prefix = '') {
            let keys = [];
            for (const key in obj) {
                const fullKey = prefix ? `${prefix}.${key}` : key;
                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    keys = keys.concat(getNestedKeys(obj[key], fullKey));
                } else {
                    keys.push(fullKey);
                }
            }
            return keys;
        }

        // æµ‹è¯•åŠŸèƒ½ç»„ä»¶
        async function testComponents() {
            const resultDiv = document.getElementById('componentTestResult');
            
            try {
                // æµ‹è¯•ç¿»è¯‘åŠ è½½å‡½æ•°
                const translations = await loadTranslations();
                if (translations) {
                    testResults.translationLoad = true;
                }

                // æµ‹è¯•è¯­è¨€è®¾ç½®é€»è¾‘
                const testLang = 'es';
                if (translations[testLang]) {
                    testResults.componentFunction = true;
                }

                if (testResults.translationLoad && testResults.componentFunction) {
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = 'âœ… æ‰€æœ‰åŠŸèƒ½ç»„ä»¶æ­£å¸¸å·¥ä½œ';
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = `âŒ ç»„ä»¶æµ‹è¯•å¤±è´¥: ç¿»è¯‘åŠ è½½=${testResults.translationLoad}, åŠŸèƒ½=${testResults.componentFunction}`;
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ ç»„ä»¶æµ‹è¯•å¼‚å¸¸: ${error.message}`;
            }
        }

        // æ›´æ–°æµ‹è¯•æ±‡æ€»
        function updateSummary() {
            const summaryDiv = document.getElementById('summaryResult');
            const allPassed = Object.values(testResults).every(result => result);
            
            const passedTests = Object.values(testResults).filter(result => result).length;
            const totalTests = Object.keys(testResults).length;
            
            if (allPassed) {
                summaryDiv.className = 'test-result success';
                summaryDiv.innerHTML = `ğŸ‰ å¤šè¯­è¨€åŠŸèƒ½æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼(${passedTests}/${totalTests})`;
            } else {
                summaryDiv.className = 'test-result error';
                summaryDiv.innerHTML = `âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ (${passedTests}/${totalTests})<br>
                    ç¿»è¯‘åŠ è½½: ${testResults.translationLoad ? 'âœ…' : 'âŒ'}<br>
                    è¯­è¨€åˆ‡æ¢: ${testResults.languageSwitch ? 'âœ…' : 'âŒ'}<br>
                    é”®å€¼å®Œæ•´: ${testResults.keyCompleteness ? 'âœ…' : 'âŒ'}<br>
                    åŠŸèƒ½ç»„ä»¶: ${testResults.componentFunction ? 'âœ…' : 'âŒ'}`;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            document.getElementById('testStatus').className = 'test-result info';
            document.getElementById('testStatus').textContent = 'ğŸ”„ æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...';
            
            await testTranslationCompleteness();
            await testComponents();
            updateSummary();
            
            document.getElementById('testStatus').className = 'test-result success';
            document.getElementById('testStatus').textContent = 'âœ… æµ‹è¯•å®Œæˆ';
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>